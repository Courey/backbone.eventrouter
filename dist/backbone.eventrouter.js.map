{"version":3,"sources":["backbone.eventrouter.js"],"names":[],"mappings":"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","file":"backbone.eventrouter.js","sourcesContent":["/**\n * backbone.eventrouter - A highly opinionated, simplistic Backbone.Router coupled with a Backbone.Radio.Channel\n * @version v0.1.0\n * @link https://github.com/RoundingWellOS/backbone.eventrouter\n * @license MIT\n */\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('underscore'), require('backbone'), require('backbone.radio')) :\n  typeof define === 'function' && define.amd ? define(['underscore', 'backbone', 'backbone.radio'], factory) :\n  global.Backbone.EventRouter = factory(global._, global.Backbone, global.Radio)\n}(this, function (_, Backbone, Radio) { 'use strict';\n\n  var EventRouter = Backbone.EventRouter = Backbone.Router.extend({\n    constructor: function(options) {\n      options = _.extend({}, options);\n\n      Backbone.Router.apply(this, arguments);\n\n      _.extend(this, _.pick(options, ['channelName', 'routeTriggers']));\n\n      this._ch = Backbone.Radio.channel(_.result(this, 'channelName'));\n\n      this._initRoutes();\n\n      this.listenTo(this._ch, 'all', this.navigateFromEvent);\n    },\n\n    channelName: 'event-router',\n\n    getChannel: function() {\n      return this._ch;\n    },\n\n    _initRoutes: function() {\n      this._routeTriggers = _.result(this, 'routeTriggers') || {};\n\n      _.each(this._routeTriggers, this._addTriggerRoute, this);\n    },\n\n    _addTriggerRoute: function(routes, event){\n      routes = _.isArray(routes) ? routes : [routes];\n\n      _.each(routes, function(route) {\n        this.route(route, event, _.bind(this._ch.trigger, this._ch, event));\n      }, this);\n    },\n\n    addTriggerRoute: function(routes, event){\n      this._routeTriggers[event] = routes;\n      this._addTriggerRoute(routes, event);\n\n      return this;\n    },\n\n    route: function(route, name, callback) {\n      if (_.isFunction(name)) {\n        callback = name;\n        name = '';\n      }\n      if (!callback) {\n        callback = this[name];\n      }\n\n      var wrappedCallback = _.bind(function() {\n        var args = Array.prototype.slice.call(arguments);\n        this.trigger('before:route', name, args);\n        this.trigger.apply(this, ['before:route:' + name].concat(args));\n        this._storeRouteTrigger([name].concat(args));\n        callback.apply(this, args);\n        this._clearRouteTrigger();\n      }, this);\n\n      return Backbone.Router.prototype.route.call(this, route, name, wrappedCallback);\n    },\n\n    _storeRouteTrigger: function(args){\n      this._routeArgs = this._routeArgs || [];\n      this._routeArgs.push(args);\n    },\n\n    _getCurrentRouteTrigger: function(){\n      return _.last(this._routeArgs) || [];\n    },\n\n    _clearRouteTrigger: function(){\n      this._routeArgs.pop();\n    },\n\n    _isTriggeredFromRoute: function(){\n      var currentRoute = this._getCurrentRouteTrigger();\n\n      if(arguments.length !== currentRoute.length){\n        return false;\n      }\n\n      return (arguments.length === _.union(arguments, this.currentRoute).length);\n    },\n\n    navigateFromEvent: function(event) {\n      var route = this.getDefaultRoute(event);\n\n      // if no matching route exists do nothing\n      if(!route) {\n        this.trigger.apply(this, ['noMatch'].concat(arguments));\n        return this;\n      }\n\n      if(this._isTriggeredFromRoute.apply(this, arguments)) {\n        return this;\n      }\n\n      var eventArgs = _.rest(arguments);\n\n      var translatedRoute = this.translateRoute(route, eventArgs);\n\n      // update URL without triggering the route\n      return this.navigate(translatedRoute, { trigger: false });\n    },\n\n    getDefaultRoute: function(event) {\n      var routes = this._routeTriggers[event];\n\n      return _.isArray(routes) ? routes[0] : routes;\n    },\n\n    _replaceParam: function(route, arg){\n      // https://github.com/jashkenas/backbone/blob/1.2.1/backbone.js#L1425\n      var namedParam = /(\\(\\?)?:\\w+/;\n\n      return route.replace(namedParam, arg);\n    },\n\n    translateRoute: function(route, eventArgs) {\n      return _.reduce(eventArgs, this._replaceParam, route);\n    }\n  });\n\n  var backbone_eventrouter = EventRouter;\n\n  return backbone_eventrouter;\n\n}));\n"],"sourceRoot":"/source/"}